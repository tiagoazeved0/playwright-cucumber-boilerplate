jobs:
  - job: Build_and_Test
    displayName: Build and Test
    steps:
      - task: DownloadPipelineArtifact@2
        inputs:
          buildType: current
          targetPath: $(Pipeline.Workspace)
      - task: NodeTool@0
        inputs:
          versionSpec: 18.x
        displayName: Install Node.js
      - script: npm ci
        displayName: Install npm packages
      - script: npx playwright install --with-deps
        displayName: Install Playwright Browsers
      - script: npm install -D playwright-bdd
        displayName: Install playwright-bdd
      - script: npm run test
        displayName: Run Playwright Tests
      - task: PublishTestResults@2
        inputs:
          testResultsFiles: playwright-report/*.xml
          testRunTitle: Playwright Tests
      - script: npm run report
        displayName: Generate Cucumber Report
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: cucumber-report
          artifact: cucumber-report
        displayName: Publish Cucumber Report
