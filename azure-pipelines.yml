jobs:
  - job: Build_and_Test
    displayName: Build and Test
    steps:
      - task: DownloadPipelineArtifact@2
        inputs:
          buildType: current
          targetPath: $(Pipeline.Workspace)
      - task: NodeTool@0
        inputs:
          versionSpec: 18.x
        displayName: Install Node.js
      - script: npm ci
        displayName: Install npm packages
      - script: npx playwright install --with-deps
        displayName: Install Playwright Browsers
      - script: npm install -D playwright-bdd
        displayName: Install playwright-bdd
      - script: |
          npx playwright test --reporter=junit  # Generate JUnit XML report
          npx playwright show-report
        displayName: Run Tests and Show Report
      - task: PublishTestResults@2
        inputs:
          testResultsFiles: playwright-report/*.xml
          testRunTitle: Playwright Tests
      - script: pwd
        displayName: "Print Working Directory"
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: playwright-report
          artifact: playwright-report
        displayName: Publish Playwright Report
