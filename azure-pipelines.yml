jobs:
  - job: Build_and_Test
    displayName: Build and Test
    steps:
      - task: DownloadPipelineArtifact@2
        inputs:
          buildType: current
          targetPath: $(Pipeline.Workspace)
      - task: NodeTool@0
        inputs:
          versionSpec: 18.x
        displayName: Install Node.js
      - script: npm ci
        displayName: Install npm packages
      - script: npx playwright install --with-deps
        displayName: Install Playwright Browsers
      - script: npm install -D playwright-bdd
        displayName: Install playwright-bdd
      - script: npm run test
        displayName: Run Tests and Show Report
        continueOnError: 'true'
      - script: ls -l $(Pipeline.Workspace)
        displayName: List Workspace Files
      - script: ls -l $(Pipeline.Workspace)/TestResults
        displayName: List TestResults Files
      - task: PublishTestResults@2
        inputs:
          testResultsFiles: $(Pipeline.Workspace)/TestResults/*.xml
          testRunTitle: Playwright Tests
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: playwright-report
          artifact: playwright-report
        displayName: Publish Playwright Report
